// Variável global para armazenar o nome
let nomeGlobal = "Anônimo";

// Perguntas fixas definidas pelo criador
const perguntasFixas = [
"01: Em quais situações se usa porcentagem?",
      "02: O que é porcentagem?",
      "03: Quais são os três tipos de porcentagem?",
      "04: Dê um exemplo de cada um dos três tipos de porcentagem:",
      "05: Converta as seguintes porcentagens para número decimal: a) 45%",
      "05: b) 24%",
      "05: c) 12%",
      "05: d) 87%",
      "05: e) 60%",
      "06: Converta de porcentagem para fração e simplifique quando possível: a) 32%",
      "06: b) 63%",
      "06: c) 14%",
      "06: d) 52%",
      "06: e) 13%",
      "07: De decimal para porcentagem: a) 0,2",
      "07: b) 0,15",
      "07: c) 0,8",
      "07: d) 0,64",
      "07: e) 0,21",
      "08: De fração para porcentagem: a) 2/3",
      "08: b) 4/10",
      "08: c) 6/8",
      "08: d) 5/10",
      "08: e) 25/2",
      "09: Calcule a porcentagem de um valor: a) 8% de 100",
      "09: b) 7% de 500",
      "09: c) 42% de 200",
      "09: d) 2% de 10",
      "09: e) 15% de 300",
      "09: f) 81% de 1000",
      "09: g) 13% de 800",
      "09: h) 63% de 84",
      "10: Calcule o novo valor do produto com desconto ou aumento: a) Desconto de 2% em uma caneta de R$8,00",
      "10: b) Desconto de 15% em uma mala de R$55,00",
      "10: c) Fatura de R$87,00 terá um aumento de 3% no próximo mês",
      "10: d) Mensalidade de R$1.560 terá aumento de 7%",
      "10: e) Desconto de 75% em uma blusa de R$350,00",
      "10: f) Salário médio de R$1.650,00 terá aumento de 12%",
      "10: g) Custos com saúde de R$300,00 aumentarão 15%",
      "10: h) Desconto de 32% em uma bolsa de R$99,00",
      "11: Qual é a porcentagem de X em relação a Y quando: a) X=15 Y=200",
      "11: b) X=12 Y=56",
      "11: c) X=84 Y=500",
      "11: d) X=13 Y=100",
      "11: e) X=2 Y=200",
      "11: f) X=12 Y=76"
];

// Carregar respostas salvas
window.onload = function() {
  const dados = JSON.parse(localStorage.getItem("respostas")) || {};
  perguntasFixas.forEach(p => mostrarPergunta(p, dados[p] || []));

  document.getElementById("exportar").addEventListener("click", exportRespostas);
  document.getElementById("limpar").addEventListener("click", limparRespostas);
  document.getElementById("confirmarNome").addEventListener("click", confirmarNome);
};

function confirmarNome() {
  const nome = document.getElementById("nomeUsuario").value.trim();
  if (nome !== "") {
    nomeGlobal = nome;
    alert("Nome confirmado: " + nomeGlobal);
  } else {
    alert("Você não digitou um nome, será usado 'Anônimo'.");
  }
}

function mostrarPergunta(texto, respostas) {
  const lista = document.getElementById("lista-perguntas");

  const divPergunta = document.createElement("div");
  divPergunta.classList.add("pergunta");

  const titulo = document.createElement("h3");
  titulo.textContent = texto;
  divPergunta.appendChild(titulo);

  // Caixa de resposta
  const campoResposta = document.createElement("textarea");
  campoResposta.placeholder = "Digite sua resposta...";
  divPergunta.appendChild(campoResposta);

  // Botão de resposta
  const botaoResposta = document.createElement("button");
  botaoResposta.textContent = "Responder";

  // Div para respostas (abaixo da caixa e botão)
  const divRespostas = document.createElement("div");

  botaoResposta.onclick = function() {
    const textoResposta = campoResposta.value.trim();
    if (textoResposta !== "") {
      const dataHora = new Date().toLocaleString("pt-BR");
      const respostaFormatada = `<strong>${nomeGlobal}</strong> respondeu: ${textoResposta} <span class="dataHora">(${dataHora})</span>`;
      const idx = salvarResposta(texto, respostaFormatada);

      const resp = criarResposta(respostaFormatada, texto, idx);
      divRespostas.appendChild(resp);
      campoResposta.value = "";
    }
  };
  divPergunta.appendChild(botaoResposta);

  // Agora adiciona as respostas abaixo da caixa e botão
  respostas.forEach((r, i) => {
    const resp = criarResposta(r, texto, i);
    divRespostas.appendChild(resp);
  });
  divPergunta.appendChild(divRespostas);

  lista.appendChild(divPergunta);
}

function criarResposta(textoResposta, pergunta, index) {
  const resp = document.createElement("div");
  resp.classList.add("resposta");

  const span = document.createElement("span");
  span.innerHTML = textoResposta; // usa innerHTML para renderizar <strong> e data/hora
  resp.appendChild(span);

  const del = document.createElement("button");
  del.classList.add("btn-excluir");
  del.textContent = "✖";
  del.title = "Excluir resposta";
  del.onclick = function() { excluirResposta(pergunta, index, resp); };
  resp.appendChild(del);

  return resp;
}

function salvarResposta(pergunta, resposta) {
  const dados = JSON.parse(localStorage.getItem("respostas")) || {};
  if (!dados[pergunta]) {
    dados[pergunta] = [];
  }
  dados[pergunta].push(resposta);
  localStorage.setItem("respostas", JSON.stringify(dados));
  return dados[pergunta].length - 1;
}

function excluirResposta(pergunta, index, elementoDOM) {
  const dados = JSON.parse(localStorage.getItem("respostas")) || {};
  if (!dados[pergunta]) return;
  dados[pergunta].splice(index, 1);
  localStorage.setItem("respostas", JSON.stringify(dados));
  elementoDOM.remove(); // remove do DOM sem reload
}

function limparRespostas() {
  if (!confirm("Tem certeza que deseja apagar todas as respostas?")) return;
  localStorage.removeItem("respostas");
  document.getElementById("lista-perguntas").innerHTML = "";
  perguntasFixas.forEach(p => mostrarPergunta(p, []));
}

function exportRespostas() {
  const dados = JSON.parse(localStorage.getItem("respostas")) || {};
  const blob = new Blob([JSON.stringify(dados, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "respostas.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

